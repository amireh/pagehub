<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title><%= yield_with_default(:title) { AppTitle } %></title>

  <% unless settings.production? %>
    <link href="/css/pagehub.css" rel="stylesheet" type="text/css" />
    <link href="/css/skins/<%= preferences["pagehub"]["skin"] %>.css" rel="stylesheet" type="text/css" />
    <!-- <link href="/js/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" /> -->
  <% else %>
    <link href="/css/pagehub.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/skins/<%= preferences["pagehub"]["skin"] %>.min.css" rel="stylesheet" type="text/css" />
  <% end %>
  <link href="/assets/app.css" rel="stylesheet" type="text/css" />

  <%= yield_content :css %>

  <!--
  <script src="/assets/app.js"></script>
  <script src="/assets/vendor/jquery-1.9.1.min.js"></script>
  <script src="/assets/vendor/jquery-ui-1.10.1.custom.min.js"></script>
  <script src="/assets/vendor/modernizr.js"></script>
  <script src="/assets/vendor/shortcut.js"></script>
  <script src="/assets/vendor/bootstrap.min.js"></script>


  <script type="text/javascript" src="/js/modernizr.js"></script>
  <script type="text/javascript" src="/assets/lib/json2.min.js"></script>
  <script type="text/javascript" src="/js/bootstrap/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/js/lib/require.js"></script>
  <script type="text/javascript" src="/js/lib/handlebars.js"></script>
  <script type="text/javascript" src="/js/lib/underscore-min.js"></script>
  <script type="text/javascript" src="/js/lib/backbone-min.js"></script>
  <script type="text/javascript" src="/js/shortcut.js"></script>
  -->
  <script>
    pagehub_settings = <%= preferences.to_json %>;
    pagehub_hooks = [];
    last_error = null; // used for debugging
  </script>

  <script src="/assets/vendor/jquery-1.9.1.min.js"></script>
  <script data-main="/assets/main" src="/assets/lib/require.js"></script>

  <%= yield_content :js %>
  <%= yield_content :scripts %>
</head>

<body class="member">

  <%= yield_content :wraps %>

  <header>
    <div class="stuff">
      <!-- <h1><a href="/">Page<em>Hub</em></a></h1> -->
      <h1>
        <a href="<%= @user.url %>"><%= @user.nickname %></a>
        <% if @space %>
          / <a href="<%= @space.url %>"><strong><%= @space.title %></strong></a>
        <% end %>
        <%#= yield_content :header %>
      </h1>

      <nav>
        <span>
          <%= current_user.nickname %>
          <% unless settings.test? %>
            <%= gravatar_tag @user, :icon %>
          <% end %>
        </span>
        <a class="listlike icon spaces" rel="tooltip" title="Your spaces" href="/spaces">Spaces</a>
        <ol class="listlike">
          <li><a href="<%= Space.url(@user) %>">Start a new space</a></li>
          <% current_user.spaces.each do |s| %>
            <li>
              <a href="<%= s.url %>"><%= s.title %></a>
            </li>
          <% end %>
        </ol>
        <a class="listlike icon help" href="/help" title="Help">Help</a>
        <%= partial "/shared/_nav_help_links" %>
        <a class="listlike icon settings" href="/settings" title="Your account">Account</a>
        <%= partial "/shared/_nav_account_links" %>
      </nav>
    </div>


  </header>

  <div class="stuff">


    <div id="status"></div>

    <%= partial "layouts/_flashes" %>

    <% klasses = [ request.path.gsub('/', ' ').strip.sanitize.split('-').first ] %>
    <% klasses << (yield_content :section if content_for?(:section)) %>

    <div id="content" class="<%= klasses.join(' ') %>">
      <%= yield %>
    </div>

    <%# partial "shared/_skin_switcher" %>

    <img class="loader" src="/css/ajax-loader-615B4E.gif" />

    <aside class="modal alert" id="html5_compatibility_notice">
      <h2>Unsupported Browser</h2>

      <p>The brower you are currently using does not appear to support
        the latest HTML5 standards which are required for PageHub to
        function correctly.
      </p>
      <p>Please update your browser or use a recent version of the
        officially supported browsers: Google Chrome, Safari 5, or Mozilla Firefox.
      </p>
    </aside>

  </div>
  <%= partial "layouts/_footer" %>

  <script>
    request = { path: <%= request.path.to_json %> };
    pagehub_hooks.push(require([ 'views/nav' ], function() { }));
  </script>

  <%= yield_content :deferred_js %>
  <%= partial "layouts/_google_analytics" %>
</body>

</html>
