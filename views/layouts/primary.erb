<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <% this_title = yield_with_default(:title) do %><%= AppTitle %><% end %>
  <title><%= title(this_title) %></title>

  <% unless settings.production? %>
    <link href="/css/pagehub.css" rel="stylesheet" type="text/css" />
    <link href="/css/skins/<%= preferences["pagehub"]["skin"] %>.css" rel="stylesheet" type="text/css" />
    <!-- <link href="/js/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" /> -->
  <% else %>
    <link href="/css/pagehub.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/skins/<%= preferences["pagehub"]["skin"] %>.min.css" rel="stylesheet" type="text/css" />
  <% end %>
  <link href="/assets/app.css" rel="stylesheet" type="text/css" />

  <%= yield_content :css %>

  <!--
  <script src="/assets/app.js"></script>
  <script src="/assets/vendor/jquery-1.9.1.min.js"></script>
  <script src="/assets/vendor/jquery-ui-1.10.1.custom.min.js"></script>
  <script src="/assets/vendor/modernizr.js"></script>
  <script src="/assets/vendor/shortcut.js"></script>
  <script src="/assets/vendor/bootstrap.min.js"></script>


  <script type="text/javascript" src="/js/modernizr.js"></script>
  <script type="text/javascript" src="/assets/lib/json2.min.js"></script>
  <script type="text/javascript" src="/js/bootstrap/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/js/lib/require.js"></script>
  <script type="text/javascript" src="/js/lib/handlebars.js"></script>
  <script type="text/javascript" src="/js/lib/underscore-min.js"></script>
  <script type="text/javascript" src="/js/lib/backbone-min.js"></script>
  <script type="text/javascript" src="/js/shortcut.js"></script>
  -->
  <script>
    pagehub_hooks = [];
  </script>

  <script src="/assets/vendor/jquery-1.9.1.min.js"></script>
  <script data-main="/assets/main" src="/assets/lib/require.js"></script>

  <%= yield_content :js %>
  <%= yield_content :scripts %>
</head>

<body class="member">

  <%= yield_content :wraps %>

  <header>
    <div class="stuff">
      <!-- <h1><a href="/">Page<em>Hub</em></a></h1> -->
      <h1>
        <a href="<%= @user.url %>"><%= @user.nickname %></a>
        <% if @space %>
          / <a href="<%= @space.url %>"><strong><%= @space.title %></strong></a>
          <a class="small hint btn btn-mini" href="<%= @space.url %>/edit/general">admin</a>
        <% end %>
        <%#= yield_content :header %>
      </h1>

      <nav>
        <span>
          <%= current_user.nickname %>
          <% if settings.production? %>
            <%= gravatar_tag @user, :icon %>
          <% end %>
        </span>
        <a class="icon dashboard" rel="tooltip" title="Your dashboard" href="/">Spaces</a>
        <% if false %>
          <ol class="listlike">
            <li><a href="<%= Space.url(@user) %>"><i class="icon-plus"></i> Create a new space</a></li>
            <% current_user.spaces.each do |s| %>
              <li>
                <a href="<%= s.url %>"><%= s.title %></a>
              </li>
            <% end %>
          </ol>
        <% end %>
        <!-- <a class="listlike icon help" href="/help" rel="tooltip" title="Help">Help</a> -->
        <%#= partial "/shared/_nav_help_links" %>
        <a href="/settings" class="icon settings" rel="tooltip" title="Your account settings">Settings</a>
        <a href="/sessions/destroy" class="icon signout" rel="tooltip" title="Sign out">Sign out</a>
      </nav>
    </div>


  </header>

  <div class="stuff">


    <div class="status-wrap">
      <div id="status"></div>
      <%= partial "layouts/_flashes" %>
    </div>


    <% klasses = [ request.path.gsub('/', ' ').strip.sanitize.split('-').first ] %>
    <% klasses << (yield_content :section if content_for?(:section)) %>

    <div id="content" class="<%= klasses.join(' ') %>">
      <%= yield %>
    </div>

    <%# partial "shared/_skin_switcher" %>

    <img class="loader" src="/assets/loading_sun.gif" />
    <div class="loader-overlay"></div>

    <aside class="hidden modal alert" id="html5_compatibility_notice">
      <h2>Unsupported Browser</h2>

      <p>The brower you are currently using does not appear to support
        the latest HTML5 standards which are required for PageHub to
        function correctly.
      </p>
      <p>Please update your browser or use a recent version of the
        officially supported browsers: Google Chrome, Safari 5, or Mozilla Firefox.
      </p>
    </aside>

  </div>
  <%= partial "layouts/_footer" %>

  <script>
    request = { path: <%= request.path.to_json %> };
    pagehub_hooks.push(require([ 'views/nav' ], function() { }));
  </script>

  <%= yield_content :deferred_js %>
  <%= partial "layouts/_google_analytics" %>
</body>

</html>
