<% content_for :title do %> Account - Settings | <%= current_user.nickname %> | PageHub <% end %>

<%= partial "users/settings/_nav" %>
<% content_for :js do %>
<script>
  $(function() {
    $("#check_availability").click(function() {
      var btn = $(this);
      $.ajax({
        url: "/users/nickname",
        type: "POST",
        data: { nickname: $("input[name=nickname]").attr("value") },
        before: ui.status.mark_pending,
        success: function(is_available) {
          is_available = JSON.parse(is_available);
          if (is_available) {
            btn.next("span").addClass("success").removeClass("error").html("available");
          } else {
            btn.next("span").addClass("error").removeClass("success").html("not available");
          }
        },
        complete: ui.status.mark_ready
      });
      return false;
    });
  });
</script>
<% end %>

<section>

  <form action="/settings/nickname" method="POST">
    <section>
    <h3>Nickname</h3>
      <label>
        Your nickname is used in the links when sharing documents with people.
        <br />
        <br />
        <div class="input-append">
          <input type="text" name="nickname" class="span3" value="<%= current_user.nickname %>" />
          <button class="btn" id="check_availability">check availability</button>
        </div>
        <span></span>
      </label>
      <p>Links to your pages will look something like this:
        <br />
        &rarr; <a><code>http://<%= request.host %>/<strong>your-nickname</strong>/<strong>space-title</strong>/<strong>page-title</strong></code></a>
      </p>
      <p class="text-warning"><em><strong>WARNING: </strong> changing your nickname will break all the links
        you've shared with people. Change it only if you know what you're doing!</em></p>

      <input type="submit" class="btn btn-danger" value="Change Nickname" />
    </section>

  </form>

  <form method="POST" action="/settings/password">
    <fieldset>
      <legend>Changing your password</legend>

      <label>
        Your current password:<br />
        <input type="password" name="password[current]" />
      </label>

      <span>
        And a new one (type it twice to confirm it):<br />
      </span>
      <label>#1 &rarr; <input type="password" name="password[new]" style="margin-bottom: 5px;" /></label>
      <label>#2 &rarr; <input type="password" name="password[confirmation]" /></label>

      <input type="submit" class="btn" value="Update password" />
    </fieldset>

  </form>
</section>