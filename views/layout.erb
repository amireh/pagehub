<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title><% yield_content :title %></title>
  <!-- <title>notebook.mxvt</title> -->

  <script type="text/javascript" src="/js/json2.min.js"></script>
  <script type="text/javascript" src="/js/jquery.1.7.1.min.js"></script>
  <script type="text/javascript" src="/js/shortcut.js"></script>
  <link href="/css/fonts/proximanova/proximanova.css" rel="stylesheet" type="text/css" />
  <link href="/css/fonts/ubuntu/stylesheet.css" rel="stylesheet" type="text/css" />
  <link href="/css/fonts/ubuntu-mono/stylesheet.css" rel="stylesheet" type="text/css" />
  <link href="/css/pagehub.css" rel="stylesheet" type="text/css" />

  <% if !flash.empty? %>
    <script type="text/javascript">
      marker = null;

      $(function() {
        $("#flashes button").click(function() {
          $(this).parent().next("hr:first").remove();
          $(this).parent().addClass("hidden");
          $(".flash_wrap").addClass("hidden");
        });
      });

    </script>
  <% end %>

  <% if logged_in? then %>
    <style>
      footer { display: none; }
    </style>

    <script>
      pagehub_settings = <%= preferences.to_json %>;
      last_error = null;
      
      $(function() {
        var show_list = function() {
          if ($(this).parent("[disabled],:disabled,.disabled").length > 0)
            return false;

          hide_list($("a.listlike.selected"));

          $(this).next("ol").show()
            .css("left", $(this).position().left);
          $(this).addClass("selected");
          $(this).unbind('click', show_list);
          $(this).bind('click', hide_list_callback);


          return false;
        }

        var hide_list_callback = function(e) {
          e.preventDefault();

          hide_list($(this));

          return false;
        }

        var hide_list = function(el) {
          $(el).removeClass("selected");
          $(el).next("ol").hide();
          $(el).bind('click', show_list);
        }
        
        $("a.listlike:not(.selected)").click(show_list);
        $("ol.listlike li:not(.sticky), ol.listlike li:not(.sticky) *").click(function() {
          var anchor = $(this).parent().prev("a.listlike");
          if (anchor.hasClass("selected")) {
            hide_list(anchor);
          }

          return true; // let the event propagate
        });

        dynamism.configure({ debug: false, logging: false })

      });

    </script>

    <script src="/js/dynamism.js"></script>
    <script src="/js/pagehub.js"></script>
    <script src="/js/pagehub_ui.js"></script>
    
  <% end %>

  <% yield_content :scripts %>

  <link href="/css/skins/<%= preferences["pagehub"]["skin"] %>.css" rel="stylesheet" type="text/css" />
</head>

<body class="member">

  <div class="header_wrap">
  </div>

  <% yield_content :wraps %>

  <div class="stuff">
    <header>
      <h1><a href="/">Page<em>Hub</em></a></h1>
      <div class="subheader"><% yield_content :header %></div>
    </header>
    
    <nav>
      <% if logged_in? %>
        <div id="admin_actions">
          <span>Hi <%= current_user.nickname %></span>
          <a class="listlike" href="/groups">Groups</a>
          <ol class="listlike">
            <li><a href="/groups/new">New group</a></li>
            <% current_user.groups.each do |g| %>
              <li>
                <a href="/groups/<%= g.name %>"><%= g.title %></a>
                <small><a style="padding: 0; margin: 0" href="/groups/<%= g.name %>/info">( info )</a></small>
              </li>
            <% end %>
          </ol>
          <a class="listlike" href="/help">Help</a>
          <%= erb :"/shared/_nav_help_links" %>
          <a class="listlike" href="/account">Account</a>
          <%= erb :"/shared/_nav_account_links" %>
        </div>
      <% else %>
        <a id="login" href="/login">login</a>
        <a href="/signup">signup</a>
      <% end %>
    </nav>

    <div id="content">
      <div id="status">
      </div>

      <% if !flash.empty? %>
        <div id="flashes">
          <% if flash.size > 1 then %>
            <ol>
              <% flash.each_pair do |ctx,msg| %>
                <li class="flash <%= ctx %>"><%= msg %></li>
              <% end %>
            </ol>
          <% else %>
            <% flash.each_pair do |ctx,msg| %>
              <span class="flash <%= ctx %>"><%= msg %></span>
            <% end %>
          <% end %>
          <button>&times;</button>
        </div>
      <% end %>


      <%= yield %>
    </div>

    <% if logged_in? %>
      <%= erb(:"shared/_skin_switcher") %>
    <% end %>

  </div>

  <%# erb :"footer" %>
  
</body>

</html>
