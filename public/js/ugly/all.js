(function(e){e.fn.jqm=function(r){var i={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:s,ajaxText:"",target:s,modal:s,toTop:s,onShow:s,onHide:s,onLoad:s};return this.each(function(){if(this._jqm)return n[this._jqm].c=e.extend({},n[this._jqm].c,r);t++,this._jqm=t,n[t]={c:e.extend(i,e.jqm.params,r),a:s,w:e(this).addClass("jqmID"+t),s:t},i.trigger&&e(this).jqmAddTrigger(i.trigger)})},e.fn.jqmAddClose=function(e){return c(this,e,"jqmHide")},e.fn.jqmAddTrigger=function(e){return c(this,e,"jqmShow")},e.fn.jqmShow=function(t){return this.each(function(){t=t||window.event,e.jqm.open(this._jqm,t)})},e.fn.jqmHide=function(t){return this.each(function(){t=t||window.event,e.jqm.close(this._jqm,t)})},e.jqm={hash:{},open:function(t,o){var a=n[t],l=a.c,c="."+l.closeClass,h=parseInt(a.w.css("z-index")),h=h>0?h:3e3,p=e("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":h-1,opacity:l.overlay/100});if(a.a)return s;a.t=o,a.a=!0,a.w.css("z-index",h),l.modal?(r[0]||f("bind"),r.push(t)):l.overlay>0?a.w.jqmAddClose(p):p=s,a.o=p?p.addClass(l.overlayClass).prependTo("body"):s;if(i){e("html,body").css({height:"100%",width:"100%"});if(p){p=p.css({position:"absolute"})[0];for(var d in{Top:1,Left:1})p.style.setExpression(d.toLowerCase(),"(_=(document.documentElement.scroll"+d+" || document.body.scroll"+d+"))+'px'")}}if(l.ajax){var v=l.target||a.w,m=l.ajax,v=typeof v=="string"?e(v,a.w):e(v),m=m.substr(0,1)=="@"?e(o).attr(m.substring(1)):m;v.html(l.ajaxText).load(m,function(){l.onLoad&&l.onLoad.call(this,a),c&&a.w.jqmAddClose(e(c,a.w)),u(a)})}else c&&a.w.jqmAddClose(e(c,a.w));return l.toTop&&a.o&&a.w.before('<span id="jqmP'+a.w[0]._jqm+'"></span>').insertAfter(a.o),l.onShow?l.onShow(a):a.w.show(),u(a),s},close:function(t){var i=n[t];return i.a?(i.a=s,r[0]&&(r.pop(),r[0]||f("unbind")),i.c.toTop&&i.o&&e("#jqmP"+i.w[0]._jqm).after(i.w).remove(),i.c.onHide?i.c.onHide(i):(i.w.hide(),i.o&&i.o.remove()),s):s},params:{}};var t=0,n=e.jqm.hash,r=[],i=e.browser.msie&&e.browser.version=="6.0",s=!1,o=e('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),u=function(t){i&&(t.o?t.o.html('<p style="width:100%;height:100%"/>').prepend(o):e("iframe.jqm",t.w)[0]||t.w.prepend(o)),a(t)},a=function(t){try{e(":input:visible",t.w)[0].focus()}catch(n){}},f=function(t){e()[t]("keypress",l)[t]("keydown",l)[t]("mousedown",l)},l=function(t){var i=n[r[r.length-1]],s=!e(t.target).parents(".jqmID"+i.s)[0];return s&&a(i),!s},c=function(t,r,i){return t.each(function(){var t=this._jqm;e(r).each(function(){this[i]||(this[i]=[],e(this).click(function(){for(var e in{jqmShow:1,jqmHide:1})for(var t in this[e])n[this[e][t]]&&n[this[e][t]].w[e](this);return s})),this[i].push(t)})})}})(jQuery);shortcut={all_shortcuts:{},add:function(e,t,n){var r={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(!n)n=r;else for(var i in r)typeof n[i]=="undefined"&&(n[i]=r[i]);var s=n.target;typeof n.target=="string"&&(s=document.getElementById(n.target));var o=this;e=e.toLowerCase();var u=function(r){r=r||window.event;if(n.disable_in_input){var i;r.target?i=r.target:r.srcElement&&(i=r.srcElement),i.nodeType==3&&(i=i.parentNode);if(i.tagName=="INPUT"||i.tagName=="TEXTAREA")return}r.keyCode?code=r.keyCode:r.which&&(code=r.which);var s=String.fromCharCode(code).toLowerCase();code==188&&(s=","),code==190&&(s=".");var o=e.split("+"),u=0,a={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},f={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},l={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};r.ctrlKey&&(l.ctrl.pressed=!0),r.shiftKey&&(l.shift.pressed=!0),r.altKey&&(l.alt.pressed=!0),r.metaKey&&(l.meta.pressed=!0);for(var c=0;k=o[c],c<o.length;c++)k=="ctrl"||k=="control"?(u++,l.ctrl.wanted=!0):k=="shift"?(u++,l.shift.wanted=!0):k=="alt"?(u++,l.alt.wanted=!0):k=="meta"?(u++,l.meta.wanted=!0):k.length>1?f[k]==code&&u++:n.keycode?n["keycode"]==code&&u++:s==k?u++:a[s]&&r.shiftKey&&(s=a[s],s==k&&u++);if(u==o.length&&l.ctrl.pressed==l.ctrl.wanted&&l.shift.pressed==l.shift.wanted&&l.alt.pressed==l.alt.wanted&&l.meta.pressed==l.meta.wanted){t(r);if(!n.propagate)return r.cancelBubble=!0,r.returnValue=!1,r.stopPropagation&&(r.stopPropagation(),r.preventDefault()),!1}};this.all_shortcuts[e]={callback:u,target:s,event:n.type},s.addEventListener?s.addEventListener(n.type,u,!1):s.attachEvent?s.attachEvent("on"+n.type,u):s["on"+n.type]=u},remove:function(e){e=e.toLowerCase();var t=this.all_shortcuts[e];delete this.all_shortcuts[e];if(!t)return;var n=t.event,r=t.target,i=t.callback;r.detachEvent?r.detachEvent("on"+n,i):r.removeEventListener?r.removeEventListener(n,i,!1):r["on"+n]=!1}};var $,jQuery;if(!$&&!jQuery)throw"jQuery could not be found, dynamism requires it.";dynamism=function(e){function u(){e.debug||(o=function(e,t){return!t||t=="D"?!1:s("["+t+"] "+e)});if(e.log_target){var t=e.log_target.html("<ol></ol>").find("ol:first");s=function(e){var n=e.substr(1,1);t.append("<li class='"+n+"'><em>"+n+"</em> "+e.substr(4)+"</li>")}}e.logging||(s=function(){})}function c(e){typeof e=="string"&&(e=[e]);var t="";for(var n=0;n<e.length;++n){if(!e[n]||e[n]=="")continue;t+="["+e[n]+"]"}return $.escape(t)}function h(e){var t=e.split(".");if(t.length==0&&!window[e])return null;var n=window[t[0]];for(var r=1;r<t.length;++r){if(!n)return null;n=n[t[r]]}return n}function p(e){var t=null,n=$(e).attr("data-dyn-target"),r=$(e).attr("data-dyn-target-index");if(!n){var i=$(e).parents("[data-dyn-entity]:not([data-dyn-index=-1]):first");if(i.length==0)return o("Unable to find any parent entity for: "+a(e),"E"),null;t=i}return t=t||$("[data-dyn-entity='"+$.escape(n)+"']"+"[data-dyn-index="+r+"]"),t.length==0?(o("Target could not be located by: "+a(e),"E"),null):t}function d(e,t,n,r){var i=r.length>0?r.join(".")+"."+e:e;i=$.escape(i);var s=n.find("[data-dyn-inject]:visible,input[data-dyn-inject][type=hidden]");n.attr("data-dyn-inject")&&(o("Self-object wants to be injected too! "+n.attr("data-dyn-inject"),"N"),s=s.add(n)),s=s.filter(function(){return $(this).attr("data-dyn-inject").trim().match(RegExp("@\\S+,\\s*"+i))}),s.each(function(){var r=$(this),s=r.attr("data-dyn-inject").trim().split(/,\s*/);if(s.length%2!=0)return alert("Syntax error: "+s.join(" ")+" are not even!"),!1;for(var u=0;u<s.length;u+=2){if(s[u+1]!=i){r.is(n)&&o("Self is not interested in "+s[u+1]);continue}if(m(r,s[u],i)){o("this element has already been injected with "+s[u]+" for "+i+", skipping","N");continue}var a=s[u].substr(1);if(a=="text")r.html().search("%"+e)!=-1?r.html(r.html().replace(RegExp("%"+e,"g"),t)):r.html(t);else{var f=r.attr(a);if(f&&f.search("%"+e)!=-1){var l=RegExp("%"+e,"g");r.attr(a,f.replace(l,t))}else r.attr(a,t)}g(r,"@"+a,i)}}),s.length==0&&o("Could not find any entity referencing: "+i,"E")}function v(e,t){return e+" "+t}function m(e,t,n){for(var i=0;i<r.length;++i){var s=r[i];if(e.is(s.o)&&s.injections.search(v(t,n))!=-1)return!0}return!1}function g(e,t,n){var i=!1;for(var s=0;s<r.length;++s){var u=r[s];if(e.is(u.o)){u.injections+=v(t,n),i=!0;break}}i||r.push({o:e,injections:v(t,n)}),o("Injection: "+n+" into "+t+" on "+a(e))}function y(e){for(var n=0;n<t.length;++n)if(t[n]==e)return!0;return!1}function b(){var e=$(this);if(!e.attr("data-dyn-hook").match(/\s*\S+,\s*\S+/))return o("hooks: invalid syntax, unable to parse event or method in: "+e.attr("data-dyn-hook"),"E"),!1;var t=e.attr("data-dyn-hook").trim().split(/,\s*/);if(t.length%2!=0)return o("hooks: invalid syntax, odd number of event<->method pairs in: "+e.attr("data-dyn-hook"),"E"),!1;var n=function(e,t){return function(n){return n.is(e)?t.apply(n,arguments):!0}},r=t.length;for(var i=0;i<r;i+=2){var s=t[i],u=t[i+1],a=h(u);typeof u=="string"&&a&&typeof a=="function"?y(s)?dynamism.add_callback(n(e,a),s):(o("hooks: binding window event: "+s+" => "+u),e.bind(s,a)):o("hooks: Invalid event or method: "+s+" => "+u,"E")}e.attr("data-dyn-hook",null)}var t=["all","addition","removal","post-removal","post-injection"],n={},r=[],i={},e=$.extend({debug:!0,logging:!0,log_target:null,log_out:null},e);$.apply_on=function(e,t){$(e).each(function(){t($(this))})};var s=function(e){console.log(e)},o;o=function(e,t){t=t||"D",s("["+t+"] "+e)};var a;a||(a=function(e){var t=$(e)[0],n="<"+t.tagName;if(t.attributes)for(var r=0;r<t.attributes.length;++r){var i=t.attributes[r];n+=" "+i.name+'="'+i.value+'"'}return n+=" />",n});var f;f||(f=function(e,t){e=e||[];for(var n=0;n<e.length;++n)t(e[n])}),f(t,function(e){n[e]=[]}),$.escape=function(e){return e.replace(/\[/g,"\\[").replace(/\]/g,"\\]")};var l=$.escape;return{configure:function(t){e=$.extend(e,t),u()},callbacks:n,add:function(e){var t=null,r=null;if(e)try{e=$(e),t=e.attr("data-dyn-entity"),r=e.attr("data-dyn-index");if(!t||!r)throw"Invalid target, has no identity or index"}catch(i){o(i),e=null}if(!e){t=$(this).attr("data-dyn-target"),r=$(this).attr("data-dyn-target-index")||-1,e=$("[data-dyn-entity='"+$.escape(t)+"']"+"[data-dyn-index="+r+"]");if(e.length==0)return o("Unable to find entity. Invalid reference by: "+a($(this))),!1}var s=$("[data-dyn-entity='"+$.escape(t)+"']:last"),u=parseInt(s.attr("data-dyn-index"))+1,c=e.clone();c.attr({hidden:null,"data-dyn-index":u});var h=RegExp(l(t+"[-1]"),"g"),p=t+"["+u+"]";return c.find("*").each(function(){var e=$(this);$.each(e.get(0).attributes,function(t,n){try{e.attr(n.name,n.value.replace(h,p))}catch(r){}}),e.attr("data-dyn-target")==t&&(e.attr("data-dyn-inject")=="index"&&e.html(u),e.attr("data-dyn-target-index",u))}),c.find("[data-dyn-inject=index]:not([data-dyn-target])").each(function(){var e=$(this);e.parents("[data-dyn-entity]:first").attr("data-dyn-entity")==c.attr("data-dyn-entity")&&e.html(u)}),dynamism.bind(c),$("[data-dyn-entity="+$.escape(t)+"]:last").after(c),f(n.addition,function(e){e(c)}),f(n.all,function(e){e(c,"addition")}),c},utility:{lookup_method:function(e){return h(e)}},remove:function(e){var t=$(e).is("[data-dyn-entity]")?$(e):p($(this)),r=$(this);if(!t)return!1;try{f(n.removal,function(e){e(t,r)}),f(n.all,function(e){e(t,"removal",r)})}catch(i){return o("Removal aborted per requested. Given cause: "+i,"E"),!1}t.remove(),f(n["post-removal"],function(e){e(null,r)}),f(n.all,function(e){e(null,"post-removal",r)})},inject:function(e,t,r){var s=!r,r=r||[],u=null;for(u in e){var a=e[u];switch(typeof a){case"string":case"number":d(u,a,t,r);break;case"object":if(isNaN(parseInt(u)))r.push(u),o("Context: "+r),dynamism.inject(a,t,r),r.pop();else{var l=r.join("."),c=null,h=i[l];o("Looking for a factory for "+l);if(h)o("	Using user-defined factory for: "+l),c=h(t,e[u],e);else{o("	Looking for a factory for model: "+l);var p=t.find("[data-dyn-spawn-on='"+l+"'][data-dyn-index=-1]");p.length>0?(o("		Found "+p.length+"!"),c=$(),p.each(function(){var e=$(this);c=c.add(dynamism.add(e))})):o("Unable to create model: "+l+", no factory found.","W")}c&&c.length>0?c.each(function(){var e=$(this);dynamism.inject(a,e,r),e.attr("data-dyn-hook")&&(f(n["post-injection"],function(t){t(e,a)}),f(n.all,function(t){t(e,"post-injection",a)}))}):o("Unable to create model: "+l+", factory didn't create a proper entity.","W")}break;default:o("Unknown value type: "+typeof a,"E")}}s&&(o("Invoking all post-injection hooks"),f(n["post-injection"],function(n){n(t,e)}),f(n.all,function(n){n(t,"post-injection",e)}))},reset:function(){r=[]},bind:function(e){if(!e||$(e).length==0)e=$("*");e.find("[data-dyn-target]:not([data-dyn-action]),[data-dyn-target][data-dyn-action='add']").unbind("click",dynamism.add).bind("click",dynamism.add),e.find("[data-dyn-action='remove']").unbind("click",dynamism.remove).bind("click",dynamism.remove)},hook:function(e){var t=null;try{t=e.find("[data-dyn-hook]:visible")}catch(n){return alert("Unable to inject: "+e+". Cause: "+n)}e.attr("data-dyn-hook")&&(t=t.add(e)),t.each(b)},add_callback:function(e,t){var t=t||"all";if(!e)throw"Undefined "+t+" callback: "+e;if(typeof e!="function")throw"Bad callback type given: "+typeof e;n[t].push(e)},on_addition:function(e){return dynamism.add_callback(e,"addition")},on_removal:function(e){return dynamism.add_callback(e,"removal")},after_removal:function(e){return dynamism.add_callback(e,"post-removal")},after_injection:function(e){return dynamism.add_callback(e,"post-injection")},register_factory:function(e,t){if(i[e])return alert("Seems like you've already registered a factory for: "+e),!1;if(typeof t!="function")return alert("Factory must be a method that creates anobject, given was: "+typeof t+" for model: "+e),!1;i[e]=t,o("Registered factory for: "+e)}}}(),$(function(){$("[data-dyn-entity]:not([data-dyn-index])").attr({"data-dyn-index":-1}),$("[data-dyn-entity][data-dyn-index=-1]").attr({hidden:"true"}),dynamism.after_injection(dynamism.hook);var e=["data-dyn-inject","data-dyn-spawn-on","data-dyn-hook"];dynamism.after_injection(function(t){for(var n=0;n<e.length;++n){var r=e[n];t.find("["+r+"]:visible").attr(r,null),t.attr(r,null)}})});foreach=function(e,t){e=e||[];for(var n=0;n<e.length;++n)t(e[n])},log=function(e,t){t=t||"D",console.log("["+t+"] "+e)},Array.prototype.has_value=function(e){for(var t=0;t<this.length;++t)if(this[t]==e)return!0;return!1},Array.prototype.pop_value=function(e){var t=-1;while((t=this.indexOf(e))!=-1)this.splice(t,1);return this},pagehub=function(){var e={resource:""},t="",n=!1,r=!1,i="/profile/preferences/runtime";return $(document).ajaxStart(function(){ui.status.mark_pending()}),$(document).ajaxComplete(function(e){ui.status.mark_ready()}),{config:e,namespace:t,settings_changed:n,content_changed:r,sync:function(){if(!pagehub.settings_changed)return;$.ajax({url:i,type:"PUT",data:{settings:pagehub.settings.runtime},error:function(e){ui.report_error("Unable to synchronize user settings: "+e.responseText)},complete:function(){pagehub.settings_changed=!1}})},pages:{create:function(e){var t=pagehub.namespace+"/pages";$.ajax({url:t,type:"POST",success:e.success,error:e.error})},update:function(e,t,n){var r=pagehub.namespace+"/pages/"+e;$.ajax({type:"PUT",url:r,data:{attributes:t},success:n.success,error:n.error})},destroy:function(e,t,n){var r=pagehub.namespace+"/pages/"+e;$.ajax({type:"DELETE",url:r,success:t,error:n})}},folders:{create:function(e,t){var n=pagehub.namespace+"/folders";$.ajax({url:n,type:"POST",data:e,success:t.success,error:t.error})},update:function(e,t,n,r){var i=pagehub.namespace+"/folders/"+e;$.ajax({type:"PUT",url:i,data:t,success:n,error:r})},destroy:function(e,t,n){var e=e,r=pagehub.namespace+"/folders/"+e;if(!e)throw"undefined id given to pagehub.folders.destroy: "+e;e=parseInt(e);if(isNaN(e)||e==0)throw"bad id given to pagehub.folders.destroy: "+e;$.ajax({type:"DELETE",url:r,success:t,error:n})}},groups:{kick:function(e,t,n){var r="/groups/"+t+"/kick/"+e;$.ajax({type:"PUT",url:r,success:n.success,error:n.error})}}}},pagehub=new pagehub,pagehub.settings=pagehub_settings,pagehub.settings.runtime||(pagehub.settings.runtime={cf:[]}),pagehub_settings=null;pagehub_ui=function(){function y(){if($(this).parent("[disabled],:disabled,.disabled").length>0)return!1;w($("a.listlike.selected,a[data-listlike].selected"));var e=$(this).next("ol");return $(this).next("ol").show(),g+e.width()+e.parent().position().left+$(this).position().left>=$(window).width()?e.css({right:0,left:0}):e.css({left:$(this).position().left,right:0}),$(this).addClass("selected"),$(this).unbind("click",y),$(this).add($(window)).bind("click",b),!1}function b(e){return e.preventDefault(),w($(".listlike.selected:visible,[data-listlike].selected:visible")),!1}function w(e){$(e).removeClass("selected"),$(e).next("ol").hide(),$(e).add($(window)).unbind("click",b),$(e).bind("click",y)}function E(){return ui.is_page_selected()?ui.current_page().attr("id").replace(/\w+_/,""):null}function S(){return ui.is_folder_selected()?ui.current_folder().parent().attr("id").replace("folder_",""):null}var e={on_entry:[]},t=null,n={autosave:null,sync:null,flash:null},r="",i=!1,s=250,o=!1,u=null,a=[],f=!1,l=2500,c={autosave:30,sync:5,flash:2.5},h={status:1},p={},d={},v={pages:{on_load:[]}},m=[function(){Modernizr.draganddrop||ui.modal.as_alert($("#html5_compatibility_notice"))},function(){dynamism.configure({debug:!1,logging:!1}),$("a[title]").tooltip({placement:"bottom"})},function(){$("[data-collapsible]").each(function(){$(this).append($("#collapser").clone().attr({id:null,hidden:null}))})},function(){$("section:not([data-untogglable])").find("> h1:first-child, > h2:first-child, > h3:first-child").addClass("togglable"),$("section > .togglable").click(function(){$(this).siblings(":not([data-untogglable])").toggle(),$(this).toggleClass("toggled")})},function(){$("#resource_editor input[type=text]").keyup(function(e){e.which==13?(e.preventDefault(),ui.resource_editor.save()):e.which==27&&(e.preventDefault(),ui.resource_editor.hide())}).click(function(e){e.preventDefault()}),$("#update_title").click(function(){return ui.resource_editor.save()}),$("#cancel_title_editing").click(function(){return ui.resource_editor.hide()})},function(){pagehub!==undefined&&pagehub.settings.editing.autosave&&(n.autosave=setInterval("ui.pages.save(true)",c.autosave*1e3),n.sync=setInterval("pagehub.sync()",c.sync*1e3))},function(){$("a[data-disabled], a.disabled").click(function(e){return e.preventDefault(),!1})},function(){$("a.listlike:not(.selected),a[data-listlike]:not(.selected)").bind("click",y),$("ol.listlike li:not(.sticky), ol.listlike li:not(.sticky) *,              ol[data-listlike] li:not(.sticky), ol[data-listlike] li:not(.sticky) *").click(function(){var e=$(this).parent().prev("a.listlike,a[data-listlike]");return e.hasClass("selected")&&w(e),!0})}],g=120;return{hooks:m,theme:r,action_hooks:v,reset_autosave_timer:function(){clearInterval(n.autosave),n.autosave=setInterval("ui.pages.save(true)",c.autosave*1e3)},current_page:function(){return $("#page_listing li.selected:not(.folder) a")},current_folder:function(){return $("#page_listing .folder > .selected")},is_page_selected:function(){return ui.current_page().length!=0},is_folder_selected:function(){return ui.current_folder().length!=0},create_editor:function(e,t){t=t||{},mxvt.markdown.setup_bindings();var n=CodeMirror.fromTextArea(document.getElementById(e),$.extend({mode:"markdown",lineNumbers:!1,matchBrackets:!0,theme:"neat",tabSize:2,gutter:!1,autoClearEmptyLines:!1,lineWrapping:!0,keyMap:"mxvt",onChange:function(){pagehub.content_changed=!0},onKeyEvent:function(e,t){return f?(t.preventDefault(),t.stopPropagation(),!0):!1}},t));return n},collapse:function(){var e=$(this);if(e.attr("data-collapse")==null)return e.siblings("[data-collapse]:first").click();e.attr("data-collapsed")?(e.siblings(":not(span.folder_title)").show(),e.attr("data-collapsed",null).html("&minus;"),e.parent().removeClass("collapsed"),pagehub.settings.runtime.cf.pop_value(parseInt(e.attr("data-folder"))),pagehub.settings_changed=!0):(e.siblings(":not(span.folder_title)").hide(),e.attr("data-collapsed",!0).html("&plus;"),e.parent().addClass("collapsed"),pagehub.settings.runtime.cf.push(parseInt(e.attr("data-folder"))),pagehub.settings_changed=!0)},modal:{as_alert:function(e,t){if(typeof e!="string"&&typeof e=="object"){var e=$(e);e.show()}}},status:{clear:function(e){if(!$("#status").is(":visible"))return(e||function(){})();$("#status").addClass("hidden").removeClass("visible"),o=!1,e&&e();if(a.length>0){var t=a.pop();return ui.status.show(t[0],t[1],t[2])}},show:function(e,n,r){n||(n="notice"),r||(r=h.status);if(o&&u!="pending")return a.push([e,n,r]);t&&clearTimeout(t),t=setTimeout("ui.status.clear()",n=="bad"?l*2:l),$("#status").removeClass("pending good bad").addClass(n+" visible").html(e),o=!0,u=n},mark_pending:function(){$(".loader").show()},mark_ready:function(){$(".loader").hide()}},is_editing:function(){return ui.is_page_selected()&&!$("#page_actions").hasClass("disabled")},on_action:function(e,t,n){var r={is_editor_action:!0},n=$.extend(r,n||{});p[e]||(p[e]={props:n,handlers:[]}),p[e].handlers.push(t)},action:function(e){var t=p[e];if(!t)return!0;if(!ui.is_editing()&&t.props.is_editor_action)return!1;for(var n=0;n<t.handlers.length;++n)t.handlers[n]();return!1},resource_editor:{show:function(){if(!ui.is_folder_selected()&&!ui.is_page_selected()){console.log("ERROR: nothing is selected, can't show resource editor");return}var e=ui.is_folder_selected()?ui.current_folder():ui.current_page(),t=$("#resource_editor"),n=t.find("input[type=text][name=title]");e.hide(),t.show(),e.after(t),n.attr("value",e.html().trim()).focus();if(ui.is_folder_selected()){var r=e.parent().attr("data-parent");r||(r="0"),t.find("select :selected").attr("selected",null),t.find("select option[value=folder_"+r+"]").attr("selected","selected"),e.parent().find("li.folder").add(e.parent()).each(function(){t.find("select option[value="+$(this).attr("id")+"]").hide()})}return!0},hide:function(e){if(!ui.is_folder_selected()&&!ui.is_page_selected())return;var t=ui.is_folder_selected()?ui.current_folder():ui.current_page(),n=$("#resource_editor"),r=n.find("input[type=text][name=title]");$("body").append(n.hide()),t.show(),ui.is_folder_selected()&&(t.siblings("button:hidden").show(),ui.dehighlight("folder"),n.find("option:hidden").show(),$("#parent_folder_selection").hide())},save:function(){var e=null;if(!ui.is_folder_selected()&&!ui.is_page_selected()){console.log("ERROR: nothing is selected, can't show resource editor");return}var t=$("#resource_editor input[type=text][name=title]").attr("value");ui.is_folder_selected()?(e=S(),$("#parent_folder_selection select :selected").length==0&&$("#parent_folder_selection select option:first").attr("selected","selected"),parent_folder=$("#parent_folder_selection select :selected").attr("value").replace("folder_",""),ui.status.show("Updating folder...","pending"),pagehub.folders.update(e,{title:t,folder_id:parent_folder},function(e){var e=JSON.parse(e);ui.folders.on_update(e)},function(e){ui.status.show("Unable to update folder: "+e.responseText,"bad")})):(e=E(),ui.status.show("Saving page title...","pending"),pagehub.pages.update(e,{title:t},{success:ui.pages.on_update,error:function(e){ui.status.show("Unable to update page: "+e.responseText,"bad")}})),ui.resource_editor.hide(!0)}},dialogs:{destroy_group:function(e){return window.location.href=$(e).attr("href"),!1},destroy_page:function(){if(!ui.is_page_selected())return!1;$("a.confirm#destroy_page").click()}},report_error:function(e){ui.status.show("A script error has occured, please try to reproduce the bug and report it.","bad"),console.log(e)},highlight:function(e){e=e||$(this),ui.dehighlight(e.hasClass("folder_title")?"folder":"page"),e.addClass("selected"),ui.is_folder_selected()||e.append($("#indicator").show())},dehighlight:function(e){e=="folder"?ui.current_folder().removeClass("selected"):ui.current_page().parent().removeClass("selected")},resources:{on_drag_start:function(e){var t=e.originalEvent;return $("#page_listing .drag-src").removeClass("drag-src"),$(this).addClass("drag-src"),t.dataTransfer.setData("ignore_me","fubar"),i=!0,!0},on_drop:function(e){e.preventDefault(),e.stopPropagation();if(!i)return $("#indicator").hide(),$("#drag_indicator").hide(),!1;var t=$("#page_listing .drag-src");console.log(t),i=!1;if(t.hasClass("folder_title")){var n=t.parent().attr("id").replace("folder_",""),r=$(this).hasClass("general-folder")?$(this).attr("id").replace("folder_",""):$(this).parent().attr("id").replace("folder_","");pagehub.folders.update(n,{folder_id:r},function(e){ui.folders.on_update(JSON.parse(e))},function(e){ui.status.show("Unable to move folder: "+e.responseText,"bad")})}else{var s=$("#page_listing .drag-src a").attr("id").replace("page_",""),o=$(this).hasClass("general-folder")?$(this).attr("id").replace("folder_",""):$(this).parent().attr("id").replace("folder_",""),u=$("#page_listing .drag-src a"),a=$("a[data-action=move][data-folder="+o+"]");E()!=s?(v.pages.on_load.push(function(){a.click(),v.pages.on_load.pop()}),u.click()):a.click()}return $("#page_listing .drag-src, #page_listing .drop-target").removeClass("drag-src drop-target"),$("#indicator").hide(),$("#drag_indicator").hide(),!1},consume_dragevent:function(e){return e.preventDefault(),!1},on_dragenter:function(){$("#page_listing").find(".drop-target").removeClass("drop-target");if($(this).is("li"))$(this).addClass("drop-target");else{if(!$(this).is("span"))return!1;$(this).parent().addClass("drop-target")}$(this).append($("#indicator").show()),$(this).append($("#drag_indicator").show())},make_draggable:function(e){var e=$(e).get(0);e.addEventListener("dragenter",ui.resources.on_dragenter),e.addEventListener("drop",ui.resources.on_drop),e.addEventListener("dragend",ui.resources.on_drop),e.addEventListener("dragleave",ui.resources.consume_dragevent),e.addEventListener("dragover",ui.resources.consume_dragevent)}},folders:{create:function(){try{$.ajax({url:pagehub.namespace+"/folders/new",success:function(e){pagehub.confirm(e,"Create a new folder",function(e){ui.status.show("Creating a new folder...","pending"),pagehub.folders.create($("#confirm form#folder_form").serialize(),{success:function(e){var e=JSON.parse(e);console.log(e),dynamism.inject({folders:[e]},$("#page_listing")),ui.status.show("Folder "+e.title+" has been created.","good")},error:function(e){ui.status.show(e.responseText,"bad")}})})}})}catch(e){log(e)}return $("a.listlike.selected,a[data-listlike].selected").click(),!1},on_update:function(e){ui.status.show("Folder updated!","good"),console.log(e);var t=$("#folder_"+e.id);e.parent?t.attr("data-parent",e.parent):t.attr("data-parent",null),t.find("> span:first").html(e.title),ui.folders.arrange($("#page_listing")),$("a[data-action=move][data-folder="+e.id+"]").html(e.title),$("#resource_editor option[value=folder_"+e.id+"]").html(e.title)},on_injection:function(e){var t=parseInt(e.attr("id").replace("folder_","")),n=t==0;e.find("> ol > li[data-dyn-index][data-dyn-index!=-1]").length>0?e.find("> ol > li:first").hide():e.find("> ol > li:first").show();if(n)e.addClass("general-folder"),e.find("> a[data-action=move]").remove(),e.find("> select").remove(),e.find("> button").remove();else{var r=e.find("a[data-action=move]");r.length==1&&$("#movement_listing").append("<li></li>").find("li:last").append(r),$("#parent_folder_selection select").append('<option value="'+e.attr("id")+'">'+e.find("> span").html()+"</option>"),pagehub.settings.runtime.cf.has_value(parseInt(t))&&e.find("button[data-collapse]").click()}if(Modernizr.draganddrop){var i=n?e.get(0):e.find("> span.folder_title:first").get(0);e.find("[draggable=true]").bind("dragstart",ui.resources.on_drag_start),ui.resources.make_draggable(i)}},arrange:function(e){ui.status.mark_pending(),e.prepend(e.find("li.folder:not([data-parent]):visible")),e.find("li.folder[data-parent]:visible").each(function(){var e=parseInt($(this).attr("data-parent")||"0"),t=$("#folder_"+e);t.length==1?t.find("> ol").append($(this)):(console.log("[ERROR]: Unknown parent "+e+"!"),console.log($(this)))});var t=function(e){e.find("> li.folder:visible").sort(function(e,t){var n=$(e).find("> span:first-child").html().trim().toUpperCase(),r=$(t).find("> span:first-child").html().trim().toUpperCase();return n<r?-1:n>r?1:0}).each(function(t,n){e.append(n)})};t(e),e.find("ol > li.folder:visible").each(function(){t($(this).parent())});var n=$("#page_listing").find(".folder.general-folder");$("#page_listing").append(n),ui.status.mark_ready()},edit_title:function(){return $("#resource_editor").is(":visible")&&ui.resource_editor.hide(),ui.highlight($(this).prev(".folder_title:first")),$(this).siblings("button[data-dyn-action=remove]:visible").hide(),$(this).hide(),$("#parent_folder_selection").show(),ui.resource_editor.show()},on_removal:function(e,t){var n=e.attr("id").replace("folder_","");if(!d[e.attr("id")])throw pagehub.folders.destroy(n,function(n){var n=JSON.parse(n);ui.status.show("Re-building the entire page listing,this could take a while...","pending"),d[e.attr("id")]=!0,e.find("li[data-dyn-entity=folder]").add(e).each(function(){var e=$(this).attr("id").replace("folder_","");$("a[data-action=move][data-folder="+e+"]").parent().remove(),$("#resource_editor option[value=folder_"+e+"]").remove()}),t.click(),$("#page_listing :visible").remove(),dynamism.reset(),dynamism.inject(n,$("#page_listing")),ui.status.show("Folder deleted.","good")},function(e){ui.status.show("Unable to delete folder: "+e.responseText,"bad")}),"Halting."},highlight:function(){var e=$(this);$(this).hasClass("highlighted")?$("span.folder_title.highlighted").removeClass("highlighted"):($(this).addClass("highlighted"),$(this).parents(".folder").find("> span.folder_title").addClass("highlighted"))}},disable_editor:function(){f=!0,$(ui.editor.getWrapperElement()).addClass("disabled")},enable_editor:function(){$(ui.editor.getWrapperElement()).removeClass("disabled"),f=!1},pages:{create:function(){return ui.status.show("Creating a new page...","pending"),pagehub.pages.create({success:function(e){var e=JSON.parse(e);dynamism.inject({folders:[{id:0,pages:[e]}]},$("#page_listing")),$("#page_"+e.id).click(),$(".general-folder li:not([data-dyn-entity]):first").hide(),ui.editor.setValue("Preparing newly created page... hold on.");if(Modernizr.draganddrop){var t=$("#page_"+e.id).parent();t.bind("dragstart",ui.resources.on_drag_start)}},error:function(e){ui.status.show("Could not create a new page: "+e.responseText,"bad"),console.log("smth bad happened"),console.log(e)}}),$("a.listlike.selected,a[data-listlike].selected").click(),!0},load:function(){if($(this).parent().hasClass("selected"))return ui.resource_editor.show(),!1;$("#page_actions").removeClass("disabled"),ui.resource_editor.hide(),ui.highlight($(this).parent()),ui.status.mark_pending(),ui.editor.save();var e=$(this).attr("id").replace("page_","");return $.ajax({type:"GET",url:pagehub.namespace+"/pages/"+e+".json",success:function(t){var t=JSON.parse(t),n=t.content,r=t.groups;ui.editor.clearHistory(),ui.editor.setValue(n),pagehub.content_changed=!1,$("#preview").attr("href",pagehub.namespace+"/pages/"+e+"/pretty"),$("#share_everybody").attr("href",pagehub.namespace+"/pages/"+e+"/share"),$("#history").attr("href",pagehub.namespace+"/pages/"+t.id+"/revisions").html($("#history").html().replace(/\d+/,t.nr_revisions)),t.nr_revisions==0?$("#history").attr("disabled","true").addClass("disabled"):$("#history").attr("disabled",null).removeClass("disabled"),$("a[data-action=share][data-group]").each(function(){var t=$(this).attr("data-group"),n=!1;for(var i=0;i<r.length;++i)if(r[i]==t){$(this).attr("data-disabled",!0),n=!0;break}n?($(this).attr("href",null),$(this).attr("data-disabled",!0)):($(this).attr("href",pagehub.namespace+"/pages/"+e+"/share/"+t),$(this).attr("data-disabled",null))}),$("a[data-action=move]").attr("data-disabled",null),$("a[data-action=move][data-folder="+t.folder+"]").attr({"data-disabled":!0}),$("a[data-action=move]").each(function(){$(this).attr("href",pagehub.namespace+"/folders/"+$(this).attr("data-folder")+"/add/"+t.id)});for(var i=0;i<v.pages.on_load.length;++i)v.pages.on_load[i](t);ui.editor.focus()},complete:function(){ui.status.mark_ready()}}),!1},save:function(e){if(!ui.is_page_selected()||!pagehub.content_changed)return;pagehub.content_changed=!0;var t=E(),n=ui.editor.getValue(),r={};e||(ui.reset_autosave_timer(),ui.disable_editor(),r={success:function(e){var e=JSON.parse(e);ui.status.show("Page updated.","good"),e.nr_revisions==0?$("#history").attr("disabled","true").addClass("disabled"):$("#history").attr("disabled",null).removeClass("disabled"),e.content&&(ui.editor.setValue(e.content),pagehub.content_changed=!1),ui.enable_editor()},error:function(e){ui.status.show("Unable to update page: "+e.responseText,"bad"),ui.enable_editor()}}),pagehub.pages.update(t,{content:n,autosave:e},r),pagehub.sync()},on_update:function(e){var e=JSON.parse(e);ui.status.show("Page updated!","good");var t=$("#page_"+e.id);t.html(e.title)},destroy:function(){if(!ui.is_page_selected())return;var e=ui.current_page(),t=E(),n=e.html();ui.resource_editor.hide(),pagehub.pages.destroy(t,function(){ui.status.show("Page "+n+" has been deleted.","good"),e.parent().remove(),ui.editor.setValue(""),ui.actions.addClass("disabled"),ui.resource_editor.hide(),$(".general-folder > ol > li:visible").length==0&&$(".general-folder > ol > li:hidden:first").show(),$("a[id^=page_]:visible:last").click()},function(e){ui.status.show("Page could not be destroyed: "+e.responseText,"bad")})},move:function(){if($(this).attr("data-disabled"))return!1;var e=$(this).attr("href"),t=ui.current_page().parent(),n=t.parents("li.folder:first"),r=$(this).attr("data-folder");return $.ajax({url:e,type:"PUT",success:function(e){var e=JSON.parse(e),r=$("#folder_"+e.folder),i=t.parent();r.find("> ol > li:not(.folder):last").after(t),r.find("> ol > li:first").hide(),i.find("> li:not(.folder):visible").length==0&&i.find("> li:first:hidden").show(),$("a[data-action=move][data-folder="+n.attr("id").replace("folder_","")+"]").attr("data-disabled",null),$("a[data-action=move][data-folder="+e.folder+"]").attr({"data-disabled":!0})},error:function(e){last_error=e,ui.status.show(e.responseText,"bad")}}),!1},preview:function(){if(!ui.is_page_selected())return!0;window.open(pagehub.namespace+"/pages/"+E()+"/pretty","_pretty")}},process_hooks:function(){for(var e=0;e<ui.hooks.length;++e)ui.hooks[e]()}}},ui=new pagehub_ui,$(function(){for(var e=0;e<ui.hooks.length;++e)ui.hooks[e]()});